#!/sbin/openrc-run

pidfile="/var/run/i2pd/i2pd.pid"
logfile="/var/log/i2pd.log"
mainconf="/etc/i2pd/i2pd.conf"
tunconf="/etc/i2pd/tunnels.conf"

name="i2pd"
command="/usr/sbin/i2pd"
command_args="--service --daemon --log=file --logfile=$logfile --conf=$mainconf --tunconf=$tunconf --pidfile=$pidfile"
description="i2p router written in C++"
required_dirs="/var/lib/i2pd"
required_files="$mainconf"
start_stop_daemon_args="--user i2p"

depend() {
  need mountall
  use net
  after bootmisc
}

start_pre() {
  if [ -r /etc/default/i2pd ]; then
    . /etc/default/i2pd
  fi

  if [ "x$I2PD_ENABLED" != "xyes" ]; then
    ewarn "i2pd disabled in /etc/default/i2pd"
    exit 1
  fi

  checkpath -f -o i2p:i2p $logfile
  checkpath -f -o i2p:i2p $pidfile

  if [ -n "$I2PD_PORT" ] && [ -e "$I2PD_PORT" ] && [ -gt 0 ]; then
    command_args="$command_args --port=$I2PD_PORT"
  fi
  if [ -n "$DAEMON_OPTS" ]; then
    command_args="$command_args $DAEMON_OPTS"
  fi
}

